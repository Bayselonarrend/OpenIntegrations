# gRPC DLL –¥–ª—è 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ

–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è DLL –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ª—é–±—ã–º–∏ gRPC —Å–µ—Ä–≤–∏—Å–∞–º–∏ –∏–∑ 1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ. –°–æ–±–∏—Ä–∞–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ proto-—Å—Ö–µ–º–∞–º–∏ —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É.

## –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

–ü–æ—Å–∫–æ–ª—å–∫—É 1–° –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ DLL –Ω–∞–ø—Ä—è–º—É—é, –∞ tonic —è–≤–ª—è–µ—Ç—Å—è async-only –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∏–π –ø–æ–¥—Ö–æ–¥:

1. **–û—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ —Å Tokio Runtime** - —Å–æ–∑–¥–∞–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø–æ—Ç–æ–∫ —Å tokio runtime –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
2. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å** - –≤—Å–µ –º–µ—Ç–æ–¥—ã DLL —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ, –Ω–æ –≤–Ω—É—Ç—Ä–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –∫–∞–Ω–∞–ª—ã –¥–ª—è —Å–≤—è–∑–∏ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º –ø–æ—Ç–æ–∫–æ–º
3. **–ë–ª–æ–∫–∏—Ä—É—é—â–∏–µ –≤—ã–∑–æ–≤—ã** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `block_on` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
4. **–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ—Å—Ç—å** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ª—é–±—ã–º–∏ gRPC —Å–µ—Ä–≤–∏—Å–∞–º–∏ —á–µ—Ä–µ–∑ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É proto —Ñ–∞–π–ª–æ–≤

–≠—Ç–æ—Ç –ø–∞—Ç—Ç–µ—Ä–Ω –≤–∑—è—Ç –∏–∑ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ mongodb –∏ mysql DLL –≤ —ç—Ç–æ–º –∂–µ –ø—Ä–æ–µ–∫—Ç–µ.

## –ú–µ—Ç–æ–¥—ã

### Connect()
–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ gRPC —Å–µ—Ä–≤–µ—Ä—É –ø–æ –∞–¥—Ä–µ—Å—É, —É–∫–∞–∑–∞–Ω–Ω–æ–º—É –≤ —Å–≤–æ–π—Å—Ç–≤–µ `ServerAddress`.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏
```json
{"result": true}
```

### Disconnect()
–û—Ç–∫–ª—é—á–∞–µ—Ç—Å—è –æ—Ç gRPC —Å–µ—Ä–≤–µ—Ä–∞.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏

### Call(RequestJSON)
–í—ã–ø–æ–ª–Ω—è–µ—Ç —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≤—ã–∑–æ–≤ –ª—é–±–æ–≥–æ gRPC –º–µ—Ç–æ–¥–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `RequestJSON` - JSON —Å—Ç—Ä–æ–∫–∞ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤—ã–∑–æ–≤–∞:
```json
{
    "service": "ExampleService",
    "method": "SayHello", 
    "request": {
        "name": "World"
    },
    "timeout_ms": 5000
}
```

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –≤—ã–∑–æ–≤–∞

### LoadProto(ProtoContent)
–ó–∞–≥—Ä—É–∂–∞–µ—Ç proto —Ñ–∞–π–ª –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ä–≤–∏—Å–∞–º–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ProtoContent` - —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ .proto —Ñ–∞–π–ª–∞ –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–º –æ–ø–µ—Ä–∞—Ü–∏–∏

### SetMetadata(MetadataJSON)
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Å–µ—Ö –ø–æ—Å–ª–µ–¥—É—é—â–∏—Ö gRPC –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `MetadataJSON` - JSON –æ–±—ä–µ–∫—Ç —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏:
```json
{
    "authorization": "Bearer token123",
    "user-id": "12345",
    "client-version": "1.0"
}
```

### SetTLS(UseTLS, AcceptInvalidCerts, CaCertPath)
–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç TLS —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (–¥–æ–ª–∂–Ω–æ –≤—ã–∑—ã–≤–∞—Ç—å—Å—è –¥–æ Connect).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `UseTLS` - –±—É–ª–µ–≤–æ, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª–∏ TLS
- `AcceptInvalidCerts` - –±—É–ª–µ–≤–æ, –ø—Ä–∏–Ω–∏–º–∞—Ç—å –ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã
- `CaCertPath` - —Å—Ç—Ä–æ–∫–∞, –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É CA —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞

### ListServices()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –∏–∑ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö proto —Ñ–∞–π–ª–æ–≤.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å–æ —Å–ø–∏—Å–∫–æ–º —Å–µ—Ä–≤–∏—Å–æ–≤
```json
{
    "result": true,
    "services": ["ExampleService", "HealthService"]
}
```

### ListMethods(ServiceName)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –º–µ—Ç–æ–¥–æ–≤ –¥–ª—è —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ServiceName` - –∏–º—è —Å–µ—Ä–≤–∏—Å–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å–æ —Å–ø–∏—Å–∫–æ–º –º–µ—Ç–æ–¥–æ–≤

### GetMethodInfo(ServiceName, MethodName)
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–µ—Ç–æ–¥–µ (—Å—Ö–µ–º–∞ –∑–∞–ø—Ä–æ—Å–∞ –∏ –æ—Ç–≤–µ—Ç–∞).

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `ServiceName` - –∏–º—è —Å–µ—Ä–≤–∏—Å–∞
- `MethodName` - –∏–º—è –º–µ—Ç–æ–¥–∞

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –º–µ—Ç–æ–¥–µ

### GetTLSSettings()
–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TLS.

**–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç:** JSON —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ TLS

## –°–≤–æ–π—Å—Ç–≤–∞

### ServerAddress
–ê–¥—Ä–µ—Å gRPC —Å–µ—Ä–≤–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "http://localhost:50051" –∏–ª–∏ "https://api.example.com:443")

## –ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ 1–°

```bsl
// –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç = –ù–æ–≤—ã–π COM–û–±—ä–µ–∫—Ç("AddIn.opi_grpc");

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ TLS (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç.SetTLS(–ò—Å—Ç–∏–Ω–∞, –õ–æ–∂—å, "C:\certs\ca.pem");

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç.ServerAddress = "https://api.example.com:443";

// –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
–†–µ–∑—É–ª—å—Ç–∞—Ç = –ö–æ–º–ø–æ–Ω–µ–Ω—Ç.Connect();
–ï—Å–ª–∏ –ù–ï –ó–Ω–∞—á–µ–Ω–∏–µ–ó–∞–ø–æ–ª–Ω–µ–Ω–æ(–†–µ–∑—É–ª—å—Ç–∞—Ç) –¢–æ–≥–¥–∞
    –°–æ–æ–±—â–∏—Ç—å("–£—Å–ø–µ—à–Ω–æ –ø–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å");
–ò–Ω–∞—á–µ
    –°–æ–æ–±—â–∏—Ç—å("–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: " + –†–µ–∑—É–ª—å—Ç–∞—Ç);
    –í–æ–∑–≤—Ä–∞—Ç;
–ö–æ–Ω–µ—Ü–ï—Å–ª–∏;

// –ó–∞–≥—Ä—É–∑–∫–∞ proto —Å—Ö–µ–º—ã
Proto–°–æ–¥–µ—Ä–∂–∏–º–æ–µ = "
|syntax = ""proto3"";
|
|package example;
|
|service ExampleService {
|    rpc SayHello (HelloRequest) returns (HelloResponse);
|}
|
|message HelloRequest {
|    string name = 1;
|}
|
|message HelloResponse {
|    string message = 1;
|}";

–†–µ–∑—É–ª—å—Ç–∞—Ç–ó–∞–≥—Ä—É–∑–∫–∏ = –ö–æ–º–ø–æ–Ω–µ–Ω—Ç.LoadProto(Proto–°–æ–¥–µ—Ä–∂–∏–º–æ–µ);

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
–°–ø–∏—Å–æ–∫–°–µ—Ä–≤–∏—Å–æ–≤ = –ö–æ–º–ø–æ–Ω–µ–Ω—Ç.ListServices();
–°–æ–æ–±—â–∏—Ç—å("–î–æ—Å—Ç—É–ø–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã: " + –°–ø–∏—Å–æ–∫–°–µ—Ä–≤–∏—Å–æ–≤);

// –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µJSON = "{
|    ""authorization"": ""Bearer your-token"",
|    ""user-id"": ""12345""
|}";
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç.SetMetadata(–ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µJSON);

// –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞
–ó–∞–ø—Ä–æ—ÅJSON = "{
|    ""service"": ""ExampleService"",
|    ""method"": ""SayHello"",
|    ""request"": {
|        ""name"": ""1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ""
|    },
|    ""timeout_ms"": 5000
|}";

–û—Ç–≤–µ—Ç = –ö–æ–º–ø–æ–Ω–µ–Ω—Ç.Call(–ó–∞–ø—Ä–æ—ÅJSON);
–°–æ–æ–±—â–∏—Ç—å("–û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: " + –û—Ç–≤–µ—Ç);

// –û—Ç–∫–ª—é—á–µ–Ω–∏–µ
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç.Disconnect();
```

## –°–±–æ—Ä–∫–∞

```bash
cargo build --release
```

–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω–∞—è DLL –±—É–¥–µ—Ç –Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ `target/release/opi_grpc.dll`

## –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ

‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:**
- –ë–∞–∑–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º backend
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å common-tcp –¥–ª—è TLS –Ω–∞—Å—Ç—Ä–æ–µ–∫
- –í—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –º–µ—Ç–æ–¥—ã DLL
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –¥–ª—è –ª—é–±—ã—Ö gRPC —Å–µ—Ä–≤–∏—Å–æ–≤
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∏ TLS

üöß **–í —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ:**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –ø–∞—Ä—Å–∏–Ω–≥ proto —Ñ–∞–π–ª–æ–≤ (–∑–∞–≥–ª—É—à–∫–∏ –≥–æ—Ç–æ–≤—ã)
- –†–µ–∞–ª—å–Ω—ã–µ gRPC –≤—ã–∑–æ–≤—ã —á–µ—Ä–µ–∑ tonic
- –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ protobuf —Å–æ–æ–±—â–µ–Ω–∏–π

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
1–°:–ü—Ä–µ–¥–ø—Ä–∏—è—Ç–∏–µ
    ‚Üì (—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã)
AddIn (mod.rs)
    ‚Üì (mpsc –∫–∞–Ω–∞–ª—ã)
GrpcBackend (backend_core.rs)
    ‚Üì (tokio runtime)
Tonic gRPC Client
    ‚Üì (HTTP/2 + protobuf)
gRPC Server
```