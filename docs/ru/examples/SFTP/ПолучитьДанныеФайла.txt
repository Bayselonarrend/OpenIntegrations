    Хост = ПараметрыФункции["SSH_Host"];
    Порт = ПараметрыФункции["SSH_Port"];

    ИспользоватьПрокси = Истина;
    НастройкиПрокси    = Неопределено;
    ВидАвторизации     = "По логину и паролю";

    Если ВидАвторизации = "По логину и паролю" Тогда

        Логин  = ПараметрыФункции["SSH_User"];
        Пароль = ПараметрыФункции["SSH_Password"];

        НастройкиSFTP = OPI_SFTP.ПолучитьНастройкиЛогинПароль(Хост, Порт, Логин, Пароль);

    ИначеЕсли ВидАвторизации = "По ключу" Тогда

        Логин         = ПараметрыФункции["SSH_User"];
        ПриватныйКлюч = "./ssh_key";
        ПубличныйКлюч = "./ssh_key.pub";

        НастройкиSFTP = OPI_SFTP.ПолучитьНастройкиПриватныйКлюч(Хост, Порт, Логин, ПриватныйКлюч, ПубличныйКлюч);

    Иначе

        Логин         = ПараметрыФункции["SSH_User"];
        НастройкиSFTP = OPI_SFTP.ПолучитьНастройкиЧерезАгента(Хост, Порт, Логин);

    КонецЕсли;

    Если ИспользоватьПрокси Тогда

        ТипПрокси = ПараметрыФункции["Proxy_Type"]; // http, socks5, socks4

        АдресПрокси  = ПараметрыФункции["Proxy_IP"];
        ПортПрокси   = ПараметрыФункции["Proxy_Port"];
        ЛогинПрокси  = ПараметрыФункции["Proxy_User"];
        ПарольПрокси = ПараметрыФункции["Proxy_Password"];

        НастройкиПрокси = OPI_SFTP.ПолучитьНастройкиПрокси(АдресПрокси, ПортПрокси, ТипПрокси, ЛогинПрокси, ПарольПрокси);

    КонецЕсли;

    Соединение = OPI_SFTP.ОткрытьСоединение(НастройкиSFTP, НастройкиПрокси);

    Если OPI_SFTP.ЭтоКоннектор(Соединение) Тогда

        Путь      = "pic_from_disk.png";
        Результат = OPI_SFTP.ПолучитьДанныеФайла(Соединение, Путь);

    Иначе
        Результат = Соединение; // Ошибка соединения
    КонецЕсли;
