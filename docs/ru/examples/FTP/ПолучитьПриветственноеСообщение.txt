    Хост   = ПараметрыФункции["FTP_IP"];
    Порт   = ПараметрыФункции["FTP_Port"];
    Логин  = ПараметрыФункции["FTP_User"];
    Пароль = ПараметрыФункции["FTP_Password"];

    ИспользоватьПрокси = Истина;
    FTPS               = Истина;

    НастройкиПрокси = Неопределено;
    НастройкиTLS    = Неопределено; // FTPS

    НастройкиFTP = OPI_FTP.ПолучитьНастройкиСоединения(Хост, Порт, Логин, Пароль);

    Если ИспользоватьПрокси Тогда

        ТипПрокси = ПараметрыФункции["Proxy_Type"]; // http, socks5, socks4

        АдресПрокси  = ПараметрыФункции["Proxy_IP"];
        ПортПрокси   = ПараметрыФункции["Proxy_Port"];
        ЛогинПрокси  = ПараметрыФункции["Proxy_User"];
        ПарольПрокси = ПараметрыФункции["Proxy_Password"];

        НастройкиПрокси = OPI_FTP.ПолучитьНастройкиПрокси(АдресПрокси, ПортПрокси, ТипПрокси, ЛогинПрокси, ПарольПрокси);

    КонецЕсли;

    Если FTPS Тогда
        НастройкиTLS = OPI_FTP.ПолучитьНастройкиTLS(Истина);
    КонецЕсли;

    Соединение = OPI_FTP.ОткрытьСоединение(НастройкиFTP, НастройкиПрокси, НастройкиTLS);

    Если OPI_FTP.ЭтоКоннектор(Соединение) Тогда
        Результат = OPI_FTP.ПолучитьПриветственноеСообщение(Соединение);
    Иначе
        Результат = Соединение; // Ошибка соединения
    КонецЕсли;
