---
sidebar_position: 4
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Ожидать входящие соединения 
 Блокирует выполнение программы до появления нового подключения



`Функция ОжидатьВходящиеСоединения(Знач TCPСервер, Знач Таймаут = 0) Экспорт`

  | Параметр | CLI опция | Тип | Обяз. | Назначение |
  |-|-|-|-|-|
  | TCPСервер | - | Произвольный | &#x2714; | TCP сервер. См. СоздатьСервер |
  | Таймаут | - | Число | &#x2716; | Максимальное время ожидания подключений. 0 > бесконечно |

  
  Возвращаемое значение:   Структура Из КлючИЗначение - Структура с идентификатором нового подключения или ошибкой

<br/>


:::caution
**NOCLI:** данный метод недоступен для использования в CLI версии
:::
<br/>



```bsl title="Пример использования для 1С:Предприятие/OneScript"
    // -- Тестовый запрос для сервера

    КлючКлиента = Новый УникальныйИдентификатор;
    Сообщение   = "Тестовая отправка данных на сервер";

    ПараметрыКлиента = Новый Массив;
    ПараметрыКлиента.Добавить("127.0.0.1:7788"); // Наш сервер
    ПараметрыКлиента.Добавить(Сообщение);        // Тестовая строка
    ПараметрыКлиента.Добавить("UTF-8");          // Кодировка
    ПараметрыКлиента.Добавить("20000");          // Таймаут, чтобы успеть запустить сервер

    // Отправка тестового запроса через клиентские методы TCP
    ФоновоеКлиента = ФоновыеЗадания.Выполнить("OPI_TCP.ОтправитьСтроку", ПараметрыКлиента, КлючКлиента);

    // --

    TCPСервер = OPI_TCP.СоздатьСервер(7788, Истина);

    НовоеПодключение = OPI_TCP.ОжидатьВходящиеСоединения(TCPСервер, 20);

    Если НовоеПодключение["result"] Тогда

        Подключение = НовоеПодключение["connection"]["id"];

        МассивПараметровОбработки = Новый Массив;
        МассивПараметровОбработки.Добавить(Подключение); // Строка: "1:7788"

        ФоновоеОбработки = ФоновыеЗадания.Выполнить("OPI_Тесты.TCP_ОбработатьПодключение", МассивПараметровОбработки);

        TCP_ОбработатьПодключение(Подключение);

    КонецЕсли;

    Отключение = OPI_TCP.ОтключитьСервер(TCPСервер);
```
    




