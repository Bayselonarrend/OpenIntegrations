---
sidebar_position: 1
description: Выполнить запрос и другие функции для работы с ClickHouse в Открытом пакете интеграций - бесплатной open-source библиотеке интеграций для 1С:Предприятие 8, OneScript и CLI
keywords: [1C, 1С, 1С:Предприятие, 1С:Предприятие 8.3, API, Интеграция, Сервисы, Обмен, OneScript, CLI, ClickHouse]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Выполнить запрос
 Выполняет запрос с указанными параметрами



`Функция ВыполнитьЗапрос(Знач Соединение, Знач Запрос, Знач Сессия = Неопределено) Экспорт`

  | Параметр | CLI опция | Тип | Обяз. | Назначение |
  |-|-|-|-|-|
  | Соединение | --conn | Произвольный | &#x2714; | Настройки или объект соединения (для gRPC) |
  | Запрос | --req | Структура Из КлючИЗначение | &#x2714; | Данные запроса. См. [`ПолучитьНастройкиЗапроса`](/docs/ClickHouse/Common-methods/Get-request-settings) |
  | Сессия | --session | Структура Из КлючИЗначение | &#x2716; | Настройки сессии. См. [`ПолучитьНастройкиСессии`](/docs/ClickHouse/Common-methods/Get-session-settings) |

  
  Возвращаемое значение:   Соответствие Из КлючИЗначение - Результат выполнения



```bsl title="Пример использования для 1С:Предприятие/OneScript"
    // Настройки соединения

    URL = "http://localhost:8123";
    Логин  = "bayselonarrend";
    Пароль = "12we...";

    Авторизация = Новый Структура(Логин, Пароль);

    Опции = Новый Структура;
    Опции.Вставить("url" , URL);
    Опции.Вставить("auth", Авторизация);

    Соединение = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиСоединенияHTTP", Опции);

    // Запрос (создание таблицы)

    ТекстЗапроса = "CREATE TABLE IF NOT EXISTS events (
    |    id UInt64,
    |    timestamp DateTime,
    |    user_id UInt32,
    |    event_type String,
    |    payload String
    |) ENGINE    = MergeTree()
    |ORDER BY (timestamp, id)";

    Опции = Новый Структура;
    Опции.Вставить("query", ТекстЗапроса);

    Запрос = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);
    Опции  = Новый Структура;
    Опции.Вставить("conn", Соединение);
    Опции.Вставить("req" , Запрос);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ВыполнитьЗапрос", Опции);

    // Запрос (вставка данных)

    ТекстЗапроса = "INSERT INTO events FORMAT JSON";

    ФорматДанных = "JSON";
    МассивДанных = Новый Массив;

    ТекущаяДата = Дата("20260101100000");

    Запись1 = Новый Структура;
    Запись1.Вставить("id"        , 1);
    Запись1.Вставить("timestamp" , ТекущаяДата);
    Запись1.Вставить("user_id"   , 100);
    Запись1.Вставить("event_type", "click");
    Запись1.Вставить("payload"   , "{}");

    Запись2 = Новый Структура;
    Запись2.Вставить("id"        , 2);
    Запись2.Вставить("timestamp" , ТекущаяДата);
    Запись2.Вставить("user_id"   , 200);
    Запись2.Вставить("event_type", "hover");
    Запись2.Вставить("payload"   , "{}");

    МассивДанных.Добавить(Запись1);
    МассивДанных.Добавить(Запись2);

    Мета = Новый Массив;
    Мета.Добавить(Новый Структура("name,type", "id"        , "UInt64"));
    Мета.Добавить(Новый Структура("name,type", "timestamp" , "DateTime"));
    Мета.Добавить(Новый Структура("name,type", "user_id"   , "UInt32"));
    Мета.Добавить(Новый Структура("name,type", "event_type", "String"));
    Мета.Добавить(Новый Структура("name,type", "payload"   , "String"));

    Данные     = Новый Структура("meta,data", Мета, МассивДанных);
    БазаДанных = "default";
    IDЗапроса  = Строка(Новый УникальныйИдентификатор());

    Опции = Новый Структура;
    Опции.Вставить("query" , ТекстЗапроса);
    Опции.Вставить("db"    , БазаДанных);
    Опции.Вставить("id"    , IDЗапроса);
    Опции.Вставить("data"  , Данные);
    Опции.Вставить("format", ФорматДанных);

    Запрос = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);
    Опции  = Новый Структура;
    Опции.Вставить("conn", Соединение);
    Опции.Вставить("req" , Запрос);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ВыполнитьЗапрос", Опции);

    // Запрос с внешней таблицей

    ИмяТаблицы       = "ext_users";
    СтруктураКолонок = Новый Структура;
    СтруктураКолонок.Вставить("id"  , "UInt64");
    СтруктураКолонок.Вставить("name", "String");

    Таб           = Символы.Таб;
    ДанныеТаблицы = "1" + Таб + "John
    |2" + Таб + "Jane
    |3" + Таб + "Bob";

    Опции = Новый Структура;
    Опции.Вставить("name"  , ИмяТаблицы);
    Опции.Вставить("cols"  , СтруктураКолонок);
    Опции.Вставить("data"  , ДанныеТаблицы);
    Опции.Вставить("format", "TSV");

    ВнешняяТаблица = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьСтруктуруВнешнейТаблицы", Опции);

    МассивВнешнихТаблиц = Новый Массив;
    МассивВнешнихТаблиц.Добавить(ВнешняяТаблица);

    ТекстЗапроса = "SELECT * FROM ext_users WHERE id > 1";

    Опции = Новый Структура;
    Опции.Вставить("query" , ТекстЗапроса);
    Опции.Вставить("format", "JSON");
    Опции.Вставить("ext"   , МассивВнешнихТаблиц);

    Запрос = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);
    Опции  = Новый Структура;
    Опции.Вставить("conn", Соединение);
    Опции.Вставить("req" , Запрос);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ВыполнитьЗапрос", Опции);

    // Выборка

    ТекстВыборки = "SELECT * FROM events";

    Опции = Новый Структура;
    Опции.Вставить("query" , ТекстВыборки);
    Опции.Вставить("format", "JSON");

    Запрос = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);
    Опции  = Новый Структура;
    Опции.Вставить("conn", Соединение);
    Опции.Вставить("req" , Запрос);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ВыполнитьЗапрос", Опции);
```
    

 <Tabs>
  
    <TabItem value="bash" label="Bash" default>
        ```bash
            # JSON данные также могут быть переданы как путь к файлу .json
            
            oint clickhouse ВыполнитьЗапрос \
              --conn "{'address':'http://127.0.0.1:9101','transport':'grpc','auth_type':'basic','user':'bayselonarrend','password':'***'}" \
              --req "{'query':'SELECT * FROM ext_grpc','format':'JSON','external_tables':[{'name':'ext_grpc','cols':{'id':'UInt64','name':'String'},'data':'1\tJohn\n2\tJane','format':'TSV'}]}"
        ```
    </TabItem>
  
    <TabItem value="bat" label="CMD/Bat" default>
        ```batch
            :: JSON данные также могут быть переданы как путь к файлу .json
            
            oint clickhouse ВыполнитьЗапрос ^
              --conn "{'address':'http://127.0.0.1:9101','transport':'grpc','auth_type':'basic','user':'bayselonarrend','password':'***'}" ^
              --req "{'query':'SELECT * FROM ext_grpc','format':'JSON','external_tables':[{'name':'ext_grpc','cols':{'id':'UInt64','name':'String'},'data':'1\tJohn\n2\tJane','format':'TSV'}]}"
        ```
    </TabItem>
</Tabs>


```json title="Результат"
{
 "status": 200,
 "result": true,
 "body": {
  "meta": [
   {
    "name": "id",
    "type": "UInt64"
   },
   {
    "name": "value",
    "type": "String"
   }
  ],
  "data": [
   {
    "id": "1",
    "value": "test1"
   },
   {
    "id": "2",
    "value": "test2"
   }
  ],
  "rows": 2,
  "statistics": {
   "elapsed": 0.004912148,
   "rows_read": 2,
   "bytes_read": 44
  }
 },
 "headers": {
  "Date": "Sat, 07 Feb 2026 07:18:39 GMT",
  "Connection": "Keep-Alive",
  "X-ClickHouse-Server-Display-Name": "clickhouse",
  "Transfer-Encoding": "chunked",
  "X-ClickHouse-Query-Id": "3cf84010-88a9-4fbc-8a70-8201511bae6d",
  "X-ClickHouse-Format": "JSON",
  "X-ClickHouse-Timezone": "Europe/Moscow",
  "Keep-Alive": "timeout=3",
  "X-ClickHouse-Summary": "{\"read_rows\":\"2\",\"read_bytes\":\"44\",\"written_rows\":\"0\",\"written_bytes\":\"0\",\"total_rows_to_read\":\"0\",\"result_rows\":\"0\",\"result_bytes\":\"0\"}",
  "Content-Type": "application/json; charset=utf-8"
 }
}
```
