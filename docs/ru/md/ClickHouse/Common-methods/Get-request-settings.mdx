---
sidebar_position: 3
description: Получить настройки запроса и другие функции для работы с ClickHouse в Открытом пакете интеграций - бесплатной open-source библиотеке интеграций для 1С:Предприятие 8, OneScript и CLI
keywords: [1C, 1С, 1С:Предприятие, 1С:Предприятие 8.3, API, Интеграция, Сервисы, Обмен, OneScript, CLI, ClickHouse]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Получить настройки запроса
 Формирует структуру описания запроса



`Функция ПолучитьНастройкиЗапроса(Знач Текст, Знач БазаДанных = Неопределено, Знач IDЗапроса = Неопределено, Знач Данные = Неопределено, Знач ФорматОтвета = "JSON", Знач ВнешниеТаблицы = Неопределено, Знач Настройки = Неопределено) Экспорт`

  | Параметр | CLI опция | Тип | Обяз. | Назначение |
  |-|-|-|-|-|
  | Текст | --query | Строка | &#x2714; | Текст запроса |
  | БазаДанных | --db | Строка | &#x2716; | База данных |
  | IDЗапроса | --id | Строка | &#x2716; | Уникальный ID запроса, если необходимо |
  | Данные | --data | Произвольный | &#x2716; | Строка, файл или двоичные данные запроса |
  | ФорматОтвета | --format | Строка | &#x2716; | Формат получения ответа: JSON, CSV, TSV и пр. |
  | ВнешниеТаблицы | --ext | Массив Из Структура | &#x2716; | Информация о внешних таблицах. См. [`ПолучитьСтруктуруВнешнейТаблицы`](/docs/ClickHouse/Common-methods/Get-external-table-structure) |
  | Настройки | --settings | Соответствие Из КлючИЗначение | &#x2716; | Дополнительные query параметры запроса |

  
  Возвращаемое значение:   Структура Из КлючИЗначение - Структура запроса

:::tip
При использовании транспорта `http` нельзя одновременно использовать `Данные` и `Внешние таблицы`

Тело ответа может быть возвращено в виде коллекции (для JSON) или в виде двоичных данных (для остальных форматов). В CLI версии двоичные данные будут представлены в виде Base64 строки
:::
<br/>


```bsl title="Пример использования для 1С:Предприятие/OneScript"
    // Минимальный запрос

    ТекстЗапроса = "SELECT 1";

    Опции = Новый Структура;
    Опции.Вставить("query", ТекстЗапроса);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);

    // Полный запрос

    IDЗапроса    = Строка(Новый УникальныйИдентификатор());
    Данные       = Новый Структура("meta,data", Новый Массив, Новый Массив);
    БазаДанных   = "default";
    ФорматОтвета = "CSV";

    ДопНастройки = Новый Соответствие;
    ДопНастройки.Вставить("max_threads", "4");

    СтруктураКолонок = Новый Структура("id,name", "UInt64", "String");
    Опции            = Новый Структура;
    Опции.Вставить("name", "ext");
    Опции.Вставить("cols", СтруктураКолонок);

    ВнешняяТаблица = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьСтруктуруВнешнейТаблицы", Опции);

    МассивТаблиц = Новый Массив;
    МассивТаблиц.Добавить(ВнешняяТаблица);

    Опции = Новый Структура;
    Опции.Вставить("query"   , ТекстЗапроса);
    Опции.Вставить("db"      , БазаДанных);
    Опции.Вставить("id"      , IDЗапроса);
    Опции.Вставить("data"    , Данные);
    Опции.Вставить("format"  , ФорматОтвета);
    Опции.Вставить("ext"     , МассивТаблиц);
    Опции.Вставить("settings", ДопНастройки);

    Результат = OPI_ПолучениеДанныхТестов.ВыполнитьТестCLI("clickhouse", "ПолучитьНастройкиЗапроса", Опции);
```
    

 <Tabs>
  
    <TabItem value="bash" label="Bash" default>
        ```bash
            # JSON данные также могут быть переданы как путь к файлу .json
            
            oint clickhouse ПолучитьНастройкиЗапроса \
              --query "SELECT * FROM ext_grpc" \
              --format "JSON" \
              --ext "[{'name':'ext_grpc','cols':{'id':'UInt64','name':'String'},'data':'1\tJohn\n2\tJane','format':'TSV'}]"
        ```
    </TabItem>
  
    <TabItem value="bat" label="CMD/Bat" default>
        ```batch
            :: JSON данные также могут быть переданы как путь к файлу .json
            
            oint clickhouse ПолучитьНастройкиЗапроса ^
              --query "SELECT * FROM ext_grpc" ^
              --format "JSON" ^
              --ext "[{'name':'ext_grpc','cols':{'id':'UInt64','name':'String'},'data':'1\tJohn\n2\tJane','format':'TSV'}]"
        ```
    </TabItem>
</Tabs>


```json title="Результат"
{
 "query": "SELECT 1",
 "database": "default",
 "id": "c89049df-81eb-4fa5-9378-043a9ccccd0d",
 "data": {
  "meta": [],
  "data": []
 },
 "format": "CSV",
 "external_tables": [
  {
   "name": "ext",
   "cols": {
    "id": "UInt64",
    "name": "String"
   }
  }
 ],
 "settings": {
  "max_threads": "4"
 }
}
```
