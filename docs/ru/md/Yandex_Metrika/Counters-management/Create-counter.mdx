---
sidebar_position: 1
description: Создать счетчик и другие функции для работы с Yandex Metrika в Открытом пакете интеграций - бесплатной open-source библиотеке интеграций для 1С:Предприятие 8, OneScript и CLI
keywords: [1C, 1С, 1С:Предприятие, 1С:Предприятие 8.3, API, Интеграция, Сервисы, Обмен, OneScript, CLI, Yandex Metrika]
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

# Создать счетчик
 Создает счетчик по описанию полей



`Функция СоздатьСчетчик(Знач Токен, Знач СтруктураСчетчика) Экспорт`

  | Параметр | CLI опция | Тип | Обяз. | Назначение |
  |-|-|-|-|-|
  | Токен | --token | Строка | &#x2714; | Токен авторизации |
  | СтруктураСчетчика | --fields | Структура Из КлючИЗначение | &#x2714; | Структура счетчика. См. ПолучитьСтруктуруСчетчика |

  
  Возвращаемое значение:   Соответствие Из КлючИЗначение - сериализованный JSON ответа от Yandex

<br/>

:::tip
Метод в документации API: [Создание счетчика](https://yandex.ru/dev/metrika/ru/management/openapi/counter/addCounter)
:::
<br/>



```bsl title="Пример использования для 1С:Предприятие/OneScript"
    Токен = "y0_AgAAAABdylaOAAy9KgAAAAEXh6i...";

    СтруктураСчетчика = Новый Структура;
    СтруктураСчетчика.Вставить("autogoals_enabled", Истина);

    СтруктураНастроекКода = Новый Структура;
    СтруктураНастроекКода.Вставить("async"          , 0);
    СтруктураНастроекКода.Вставить("clickmap"       , 1);
    СтруктураНастроекКода.Вставить("ecommerce"      , 1);
    СтруктураНастроекКода.Вставить("in_one_line"    , 0);
    СтруктураНастроекКода.Вставить("track_hash"     , 1);
    СтруктураНастроекКода.Вставить("visor"          , 1);
    СтруктураНастроекКода.Вставить("xml_site"       , 0);
    СтруктураНастроекКода.Вставить("ytm"            , 0);
    СтруктураНастроекКода.Вставить("alternative_cdn", 1);

    СтруктураИнформера = Новый Структура;
    СтруктураИнформера.Вставить("color_arrow", 1);
    СтруктураИнформера.Вставить("color_end"  , "EFEFEFFE");
    СтруктураИнформера.Вставить("color_start", "EEEEEEEE");
    СтруктураИнформера.Вставить("color_text" , 0);
    СтруктураИнформера.Вставить("enabled"    , 1);
    СтруктураИнформера.Вставить("indicator"  , "uniques");
    СтруктураИнформера.Вставить("size"       , 2);
    СтруктураИнформера.Вставить("type"       , "ext");

    СтруктураНастроекКода.Вставить("informer", СтруктураИнформера);

    СтруктураСчетчика.Вставить("code_options", СтруктураНастроекКода);

    СтруктураФлагов = Новый Структура;
    СтруктураФлагов.Вставить("collect_first_party_data"             , Истина);
    СтруктураФлагов.Вставить("measurement_enabled"                  , Истина);
    СтруктураФлагов.Вставить("use_in_benchmarks"                    , Истина);
    СтруктураФлагов.Вставить("direct_allow_use_goals_without_access", Истина);

    СтруктураСчетчика.Вставить("counter_flags"          , СтруктураФлагов);
    СтруктураСчетчика.Вставить("favorite"               , 1);
    СтруктураСчетчика.Вставить("filter_robots"          , 2);
    СтруктураСчетчика.Вставить("gdpr_agreement_accepted", 1);

    СтруктураДомена = Новый Структура("site", "openintegrations.dev");

    СтруктураСчетчика.Вставить("site2", СтруктураДомена);

    Результат = OPI_YandexMetrika.СоздатьСчетчик(Токен, СтруктураСчетчика);
```
    

 <Tabs>
  
    <TabItem value="bash" label="Bash" default>
        ```bash
            # JSON данные также могут быть переданы как путь к файлу .json
            
            oint metrika СоздатьСчетчик \
              --token "***" \
              --fields "{'autogoals_enabled':true,'code_options':{'async':0,'clickmap':1,'ecommerce':1,'in_one_line':0,'track_hash':1,'visor':1,'xml_site':0,'ytm':0,'alternative_cdn':1,'informer':{'color_arrow':1,'color_end':'EFEFEFFE','color_start':'EEEEEEEE','color_text':0,'enabled':1,'indicator':'uniques','size':2,'type':'ext'}},'counter_flags':{'collect_first_party_data':true,'measurement_enabled':true,'use_in_benchmarks':true,'direct_allow_use_goals_without_access':true},'favorite':1,'filter_robots':2,'gdpr_agreement_accepted':1,'site2':{'site':'openintegrations.dev'}}"
        ```
    </TabItem>
  
    <TabItem value="bat" label="CMD/Bat" default>
        ```batch
            :: JSON данные также могут быть переданы как путь к файлу .json
            
            oint metrika СоздатьСчетчик ^
              --token "***" ^
              --fields "{'autogoals_enabled':true,'code_options':{'async':0,'clickmap':1,'ecommerce':1,'in_one_line':0,'track_hash':1,'visor':1,'xml_site':0,'ytm':0,'alternative_cdn':1,'informer':{'color_arrow':1,'color_end':'EFEFEFFE','color_start':'EEEEEEEE','color_text':0,'enabled':1,'indicator':'uniques','size':2,'type':'ext'}},'counter_flags':{'collect_first_party_data':true,'measurement_enabled':true,'use_in_benchmarks':true,'direct_allow_use_goals_without_access':true},'favorite':1,'filter_robots':2,'gdpr_agreement_accepted':1,'site2':{'site':'openintegrations.dev'}}"
        ```
    </TabItem>
</Tabs>


```json title="Результат"
{
 "counter": {
  "id": 98876516,
  "status": "Active",
  "owner_login": "bayselonarrend",
  "code_status": "CS_ERR_UNKNOWN",
  "activity_status": "low",
  "type": "simple",
  "favorite": 0,
  "hide_address": 0,
  "pro": 0,
  "permission": "own",
  "webvisor": {
   "arch_enabled": 0,
   "arch_type": "none",
   "load_player_type": "proxy",
   "wv_version": 2,
   "allow_wv2": true,
   "wv_forms": 1
  },
  "code_options": {
   "async": 0,
   "informer": {
    "enabled": 1,
    "type": "ext",
    "size": 2,
    "indicator": "uniques",
    "color_start": "EEEEEEEE",
    "color_end": "EFEFEFFE",
    "color_text": 0,
    "color_arrow": 1
   },
   "visor": 1,
   "track_hash": 1,
   "xml_site": 0,
   "clickmap": 1,
   "in_one_line": 0,
   "ecommerce": 1,
   "alternative_cdn": 1,
   "ecommerce_object": "dataLayer",
   "ytm": false
  },
  "create_time": "2024-11-10T21:51:32+03:00",
  "time_zone_name": "Europe/Moscow",
  "time_zone_offset": 180,
  "partner_id": 0,
  "update_time": "2024-11-10 21:51:33",
  "code": "<!-- Yandex.Metrika informer -->\n<a href=\"https://metrica.yandex.com/stat/?id=98876516&amp;from=informer\" target=\"_blank\" rel=\"nofollow\">\n    <img src=\"//bs.yandex.ru/informer/98876516/2_1_EEEEEEEE_EFEFEFFE_0_uniques\"\n         style=\"width:80px; height:31px; border:0;\"\n         alt=\"Yandex.Metrica\"\n         title=\"Yandex.Metrica: data for today (unique users)\"\n        onclick=\"try{Ya.Metrika.informer({i:this,id:98876516,lang:'en'});return false}catch(e){}\"/>\n</a>\n<!-- /Yandex.Metrika informer -->\n\n<!-- Yandex.Metrika counter -->\n<script type=\"text/javascript\">\n    (function(m,e,t,r,i,k,a){\n        m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};\n        m[i].l=1*new Date();\n        k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)\n    })(window, document,'script','//mc.webvisor.org/metrika/tag_ww.js', 'ym');\n\n    ym(98876516, 'init', {accurateTrackBounce:true, trackLinks:true, webvisor:true, trackHash:true, clickmap:true, ecommerce:\"dataLayer\", params: {__ym: {isFromApi: 'yesIsFromApi'}}});\n</script>\n<noscript><div><img src=\"https://mc.yandex.ru/watch/98876516\" style=\"position:absolute; left:-9999px;\" alt=\"\" /></div></noscript>\n<!-- /Yandex.Metrika counter -->\n\n\n",
  "monitoring": {
   "enable_monitoring": 0,
   "emails": [],
   "sms_allowed": 1,
   "enable_sms": 0,
   "phones": [],
   "phone_ids": [],
   "possible_phones": [
    "+37544*****91"
   ],
   "possible_phone_ids": [
    598854008
   ]
  },
  "filter_robots": 2,
  "currency": 643,
  "currency_code": "RUB",
  "visit_threshold": 1800,
  "max_goals": 200,
  "max_operations": 30,
  "max_filters": 30,
  "features": [
   "webvisor2"
  ],
  "site": "openintegrations.dev",
  "site2": {
   "site": "openintegrations.dev",
   "domain": "openintegrations.dev"
  },
  "gdpr_agreement_accepted": 1,
  "autogoals_enabled": true
 }
}
```
