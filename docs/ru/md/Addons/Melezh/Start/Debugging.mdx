---
id: Debugging
keywords: [1C, 1С, 1С:Предприятие, 1С:Предприятие 8.3, API, Интеграция, Сервисы, Обмен, OneScript, CLI]
title: Отладка
sidebar_position: 5
---

В этом разделе содержится информация о настройке и способах отладки проектов на базе Melezh

### Включение отладки Melezh в контейнере

:::tip
Работает в Melezh начиная с версии `0.9.0` при использовании OneScript Debug Adapter `>=1.1.0`
:::

В Docker-образах Melezh по умолчанию прописан порт отладки 1931 для [OneScript Debug Adapter](https://marketplace.visualstudio.com/items?itemName=EvilBeaver.oscript-debug). Этот порт необходимо прокинуть на локальную машину, после чего создать в VS Code 'launch.json' следующего содержания:

```json
{
    "version": "0.2.0",
    "configurations": [
        {
            "name": "Melezh Attach",
            "type": "oscript",
            "request": "attach",
            "debugPort": 1831,
            "pathsMapping": {
                "remotePath": "/app",
                "localPath": "D:/Repos/Melezh"
            }
        },
    ]
}
```
Удаленный каталог `/app` - основной каталог рабочей области Melezh внутри контейнера, где хранится файл проекта, каталог логов и от которого считаются относительные пути в настройках. Рекомендуется указать его как volume на локальной машине (`D:/Repos/Melezh` из примера) при создании контейнера и создать там подкаталог для расширений, которые необходимо отлаживать. Этого будет достаточно для отладки расширений и правки их "на горячую". Для отладки всего Melezh, включая внутренние системы, необходимо подключить или воссоздать структуру каталогов Melezh на локальной машине, так как в процессе отладки база для расчета путей к модулям определяется по полями `remotePath` и `localPath`. Все относительные пути к отлаживаемым файлам после этих базовых путей на локальной машине и в контейнере должны совпадать. Например, при файле 'launch.json' из примера, модуль `/app/my_extension/extension.os` можно отладить на локальной машине, работая с модулем `D:/Repos/Melezh/my_extension/extension.os` в редакторе кода

### Отладка на локальной машине

Для начала отладки на локальной машине, вы можете либо запустить Melezh через адаптера в VS Code (процесс Melezh будет завершен по окончании отладки), либо, как и в случае работы с Docker контейнером, выделить постоянный порт для подключения к нему отладчика по необходимости

**Для запуска отладки Melezh через VS Code**, необходимо открыть основную директорию установки Melezh как проект и создать `launch.json` следующего содержания:

```json
{
    "name": "Отладка Melezh UI",
    "type": "oscript",
    "request": "launch",
    "program": "${workspaceRoot}/core/Classes/app.os",
    "args": ["ЗапуститьПроект", "--port", "1921", "--proj", "D:/test_proj.melezh", "--debug"],
    "cwd": "${workspaceRoot}",
    "env": {},
    "runtimeExecutable": null,
    "runtimeArgs": [],
    "debugPort": 2801
}
```

+ В поле `program` необходимо указать путь к файлу `core/Classes/app.os` в каталоге Melezh
+ В поле `args` необходимо заменить `port` и `proj` на свои порт запуска и путь к файлу отлаживаемого проекта соответственно

:::important
Если Melezh был установлен из установщика Windows или Linux пакета, то OneScript может отсутствовать на целевой машине в качестве отдельного приложения, прописанного в PATH. В таком случае, можно установить OneScript отдельно, либо прописать в поле `runtimeExecutable` путь к встроенному движку OneScript внутри Melezh

На Linux: `usr/share/oint/bin/oscript`
На Windows: `{Каталог установки oint}\OInt\share\oint\bin\oscript.exe`
:::

После запуска отладки в VS Code, можно устанавливать точки останова как в основных скриптах Melezh, так и в файлах пользовательских расширений

**Для запуска Melezh с постоянным портом отладки**, необходимо:

 - Если Melezh был установлен из Windows установщика или Linux-пакета, то достаточно перед запуском `melezh` установить значение переменной окружения `MELEZH_DEBUG` с предпочтительным номером порта, по которому отладчик будет доступен в дальнейшем

 - Если Melezh был установлен как OPM пакет, то необходимо изменить файл `melezh.bat/melezh.sh` в `OneScript/bin`, добавив `-debug -port="Номер порта" -noWait` между `oscript` и путем к `app.os`. Например:

 ```bash
oscript -debug -port="1931" -noWait /usr/share/oint/lib/melezh/core/Classes/app.os "$@"
 ```

 Подключиться к процессу для отладки после запуска Melezh можно при помощи Debug Adapter c `launch.json` следующего вида:

 ```json
{
    "name": "Подключение Melezh",
    "type": "oscript",
    "request": "attach",
    "debugPort": 1931
}
 ```