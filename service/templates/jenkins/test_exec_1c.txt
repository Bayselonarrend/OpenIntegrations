			catchError(buildResult: 'FAILURE', stageResult: 'FAILURE') {   

                script {
				    runCommand('"%1" /IBConnectionString "Srvr=\"\"%2\"\";Ref=\"\"%3\"\";" /C"RunUnitTests=%5"')
            
                    timeout(time: 60, unit: 'MINUTES') {
                        waitUntil {
                            fileExists './test_results/%4.code'
                        }
                    }

                    if (fileExists('./test_results/%4.report')) {
                        def reportContent = readFile('./test_results/%4.report')
                        echo "=== report content ==="
                        echo reportContent
                        echo "=========================="
                    } else {
                        echo "WARNING: %4.report file not found"
                    }

                    def exitCode = readFile('code.log').trim().replaceAll("[^0-9]", "")
                    if (exitCode != "0") {
                        error "Tests failed with exit code: ${exitCode}"
                    }
                }
			}