pipeline {
	agent {
		label 'windows'
	}

    stages {
        stage('OpenIntegrations - Build') {
            steps {
                build job: 'OpiBuild/OpiMain', wait: true
            }
        }
        stage('Melezh - Main + Release') {
            steps {
                build job: 'Melezh/MelezhRelease', wait: true
            }
        }
        stage('OpenIntegrations - 1C DB Update') {
            steps {
                build job: 'OpiBuild/OpiBaseUpdate', wait: true
            }
        }
        stage('OpenIntegrations - Release') {
            steps {
                echo 'Release (OpenIntegrations)'
                build job: 'OpiBuild/OpiRelease', wait: true
            }
        }
        stage('Melezh - Docker') {
            steps {
                build job: 'Melezh/MelezhDocker', wait: true,
                    parameters: [
                            [$class: 'StringParameterValue', name: 'VERSION', value: 'draft'],
                            [$class: 'StringParameterValue', name: 'MELEZH_VERSION', value: '0.7.0'],
                            [$class: 'StringParameterValue', name: 'OINT_VERSION', value: '1.30.0'],
                            [$class: 'StringParameterValue', name: 'OINT_BUILD_ID', value: 'lastSuccessfulBuild']
                    ]
            }
        }

        stage('Melezh - Test') {
            steps {
                build job: 'Melezh/MelezhTests', wait: true
            }
        }
    }
}